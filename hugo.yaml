{{ define "main" }}
<link rel="stylesheet" href="{{ "css/home.css" | relURL }}">

<section class="hero">
  <div class="hero-bg"></div>
  <div class="hero-content">
    <h1>Hi，我是 Ray</h1>
    <p class="subtitle">学生｜数码玩家｜随手记点东西</p>
    <div class="hero-buttons">
      <a class="btn" href="/posts/">开始阅读</a>
      <a class="btn ghost" href="/about/">关于我</a>
    </div>
  </div>
</section>

<section class="cards container">
  <h2 class="sec-title">最新文章</h2>
  <div id="grid" class="grid">
    <!-- 先渲染“静态文章”（手动写的 Markdown） -->
    {{ range first 6 (where .Site.RegularPages "Type" "in" (slice "posts" "post")) }}
      <a class="card" href="{{ .RelPermalink }}">
        <div class="cover">
          {{ with .Params.cover.image }}<img src="{{ . | relURL }}" alt="{{ $.Title }}">{{ else }}<div class="ph"></div>{{ end }}
        </div>
        <div class="meta">
          <h3 class="title">{{ .Title }}</h3>
          <p class="desc">{{ .Summary | plainify | truncate 96 }}</p>
          <div class="info"><span>{{ .Date.Format "2006-01-02" }}</span></div>
        </div>
      </a>
    {{ end }}
  </div>
  <div class="more"><a class="btn ghost" href="/archives/">进入归档</a></div>
</section>

<script>
(async () => {
  // 再追加“动态文章”
  const box = document.getElementById('grid');
  try {
    const r = await fetch('/api/posts?limit=6');
    const d = await r.json();
    if (d.ok) {
      const html = d.list.map(p => `
        <a class="card" href="/p/${p.slug}">
          <div class="cover">${p.cover ? `<img src="${p.cover}" alt="${p.title}">` : `<div class="ph"></div>`}</div>
          <div class="meta">
            <h3 class="title">${p.title}</h3>
            <p class="desc">${(p.content||'').replace(/<[^>]+>/g,'').slice(0,96)}</p>
            <div class="info"><span>${(p.created_at||'').replace('T',' ').slice(0,10)}</span></div>
          </div>
        </a>`).join('');
      box.insertAdjacentHTML('beforeend', html);
    }
  } catch (e) {}
})();
</script>

<!-- 右下角“管理” -->
<a href="/admin/" class="fab-admin" title="管理">管理</a>
{{ end }}
